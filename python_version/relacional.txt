#aventura 0 -> por defecto
AVENTURA:
    - id INT AUTO_INCREMENT PRIMARY KEY
    - nombre VARCHAR(60) NOT NULL CHECK (trim(nombre) <> "")
    - narrador VARCHAR(80)
    - fecha_estelar DATE NOT NULL
    UNIQUE (aventura)

BIEN:
	- id INT AUTO_INCREMENT PRIMARY KEY
    - nombre VARCHAR(60) NOT NULL CHECK (trim(nombre) <> "")
    - peso INT NOT NULL CHECK (peso >= 0)
    - auxiliar_necesario FLOAT NOT NULL CHECK (auxiliar_necesario >= 0)
    - camarotes_ocupados INT NOT NULL CHECK (camarotes_ocupados >= 0)
    - aventura INT NOT NULL
    UNIQUE (nombre, aventura)
    FOREIGN KEY (aventura) REFERENCES aventura(id)

VALOR:
    - precio INT NOT NULL
    - saltos INT NOT NULL
    - bien INT NOT NULL
    FOREIGN KEY (bien) REFERENCES bien(id)
    PRIMARY KEY (bien, saltos)

REGLA:
	- id INT AUTO_INCREMENT PRIMARY KEY
	- tipo TIPO NOT NULL # planetario, flota, etc.
	- ambito AMBITO NOT NULL # comercio, pasajeros, correo, etc.
	- nombre VARCHAR(50) NOT NULL CHECK (trim(nombre) <> "")
	- esta_activo BOOL NOT NULL
	- campo_objetivo VARCHAR(30) NOT NULL CHECK (trim(campo_objetivo) <> "")
	- aventura INT NOT NULL
	FOREIGN KEY (aventura) REFERENCES aventura(id)

# minimo o maximo NULL -> sin mínimo o máximo. En Python será None
INTERVALO:
	- id INT AUTO_INCREMENT PRIMARY KEY
	- minimo INT
	- maximo INT
	- descripcion VARCHAR(20) NOT NULL CHECK (trim(descripcion) <> "")
	- bono INT NOT NULL
	FOREIGN KEY (regla) REFERENCES regla(id)

FLOTA:
    - id INT AUTO_INCREMENT PRIMARY KEY
    - nombre VARCHAR(60) NOT NULL CHECK (trim(nombre) <> "")
    - esta_activa BOOL NOT NULL
    - aventura INT NOT NULL
    - mayor_rango_marina INT NOT NULL
    - mayor_rango_explorador INT NOT NULL
    - mayor_rango_broker INT NOT NULL
    - mayor_rango_socializar INT NOT NULL
    - mayor_rango_callejeo INT NOT NULL
    - mayor_bono_soc INT NOT NULL
    FOREIGN KEY (aventura) REFERENCES aventura(id)
    UNIQUE(nombre, aventura)

REGISTRO_VIAJE
	- flota INT NOT NULL
	- fecha DATE NOT NULL
	- sistema INT NOT NULL
	FOREIGN KEY (flota) REFERENCES flota(id)
    FOREIGN KEY (sistema) REFERENCES mercado(id)

# espacio: mercado o nave
LUGAR:
    - id INT AUTO_INCREMENT PRIMARY KEY
    - nombre VARCHAR(80) NOT NULL CHECK (trim(nombre) <> "")
    - tipo ESPACIO NOT NULL
    - aventura INT NOT NULL
    UNIQUE(nombre, aventura)
    FOREIGN KEY (aventura) REFERENCES aventura(id)

NAVE:
    - id INT NOT NULL
    - carga_maxima INT NOT NULL CHECK (carga_maxima > 0)
    - auxiliar_total INT NOT NULL
    - mayor_auxiliar INT NOT NULL
    - camarotes_totales INT NOT NULL CHECK (camarotes_totales > 0)
    - literas_frias INT NOT NULL CHECK (literas_frias >= 0)
    - combustible INT NOT NULL CHECK (combustible > 0)
    - salto INT NOT NULL CHECK (salto >= 0)
    - armado BOOL NOT NULL
    - mantenimiento INT NOT NULL CHECK (mantenimiento > 0)
    - hipoteca INT NOT NULL CHECK (hipoteca >= 0)
    - fin_hipo DATE NOT NULL
    FOREIGN KEY (id) REFERENCES LUGAR_PAQUETE(id)
    

NAVE_EN_FLOTA:
    - nave INT NOT NULL
    - flota INT NOT NULL
    - fecha_incorporacion DATE NOT NULL
    - fecha_finalizacion DATE NULL # NULL (por defecto) significa que sigue allí
    FOREIGN KEY (nave) REFERENCES nave(id)
    FOREIGN KEY (flota) REFERENCES flota(id)
    CHECK ((SELECT count(*) FROM nave_en_flota AS n 
WHERE n.nave = nave AND n.fecha_finalizacion IS NULL) <= 1)
    PRIMARY KEY (nave, flota, fecha_incorporacion)

MERCADO:
    - id INT NOT NULL
    - codigo_planeta CHAR(9) NOT NULL
    FOREIGN KEY (id) REFERENCES lugar_paquete(id)

PAQUETE:
    - id INT AUTO_INCREMENT PRIMARY KEY
    - nombre VARCHAR(150) NOT NULL CHECK (trim(nombre) <> "")
    - carga INT NOT NULL
    - auxiliar_necesario INT NOT NULL
    - camarotes_ocupados INT NOT NULL
    - notas TEXT
    - nave INT NOT NULL
    FOREIGN KEY (nave) REFERENCES nave(id)

PAQUETE_EN_LUGAR:
    - paquete INT NOT NULL
    - lugar INT NOT NULL
    - fecha_incorporacion DATE NOT NULL
    - fecha_finalizacion DATE NULL # NULL (por defecto) significa que sigue allí
    CHECK ((SELECT count(*) FROM paquete_en_lugar AS p 
WHERE p.paquete = paquete AND p.fecha_finalizacion IS NULL) <= 1)
    FOREIGN KEY (paquete) REFERENCES paquete(id)
    FOREIGN KEY (lugar) REFERENCES lugar(id)
    PRIMARY KEY (paquete, lugar, fecha_incorporacion)

OPERACION:
    - id INT AUTO_INCREMENT PRIMARY KEY
    - concepto VARCHAR(200) INT NOT NULL CHECK (trim(concepto) <> "")
    - importe INT NOT NULL
    - fecha DATE NOT NULL
    - activo BOOL NOT NULL
    - notas TEXT
    - aventura INT NOT NULL
    FOREIGN KEY (aventura) REFERENCES aventura(id)

<aventura>
    <bien>
        <valor/>
    </bien>
    <regla>
        <intervalo/>
    </regla>
    <flota>
        <registro_viaje/>
    </flota>
    <lugar>
        <mercado/>
        <nave>
            <nave_en_flota foreign="flota"/>
            <paquete>
                <paquete_en_lugar foreign="mercado"/>
            </paquete>
        </nave>
    </lugar>
    <operacion/>
</aventura>
