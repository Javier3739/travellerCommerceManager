/*GESTORBASE
	- conexion SQLITE_CONNECTION
	* guardar_aventura
	* cargar_aventura
	* eliminar_aventura
	* cargar_bien
	* cambiar_bien
	* nueva_regla
	* modificar_regla
	* borrar_regla
	* nuevo_intervalo
	* cargar_intervalo
	* modificar_intervalo
	* borrar_intervalo
	* nueva_flota
	* cargar_flota
	* modificar_flota
	* eliminar_flota*/

PRINCIPAL:
	- aventura AVENTURA
    - base_datos GESTORBASE
	* VOID nueva_aventura(nombre STR)
	* <STR>list mostrar_aventuras(VOID)
	* <

AVENTURA:
    - id INT
    - nombre STR
    - narrador STR
    - fecha_estelar DATE
    - bienes <BIEN>list
    - reglas (<REGLA>list)dict # las claves son los ámbitos
    - flotas <FLOTA>list
    - dinero <INT>
    - lugares <LUGAR>dict
    - registro_integrantes REGISTRO_INTEGRANTES
    - registro_viajes REGISTRO_VIAJES
    - registro_paquetes REGISTRO_PAQUETES
    - registro_transacciones REGISTRO_TRANSACCIONES
	* VOID __init__(id INT, nombre STR, narrador STR=None, fecha_estelar DATE)
	* VOID cambiar_nombre(nombre STR)
	* VOID cambiar_fecha (nueva_fecha DATE)
	* VOID avanzar_fecha (dias INT)
	* BOOL bien_existe(nombre STR)
	* BOOL flota_existe(nombre STR)
	* BOOL lugar_existe(nombre STR)
	* VOID mover_flota(nombre_flota STR, destino STR)
	* INT calcular_modificador_pasajeros(nombre_flota STR)
	* INT calcular_cantidad_pasajeros(tirada INT)
    
	# vigilar que no haya 2 casos donde, para una nave dada, haya 2 fecha_finalizacion NULL

BIEN:
	- id INT 
    - nombre STR
    - peso INT
    - auxiliar_necesario FLOAT
    - camarotes_ocupados INT
    - valores <int>dict # los índices son los saltos
    * VOID __init__(id INT, nombre STR, peso INT, auxiliar_necesario FLOAT, camarotes_ocupados INT)
    #getters y setters, excepto un setter de id.

TIPO: ENUM("planetario", "flota", "nave", ...)
AMBITO: ENUM("comercio", "pasajeros", "correo", ...)
ESPACIO: ENUM("mercado", "nave")

REGLA:
	- id INT
	- tipo TIPO
	- ambito AMBITO
	- nombre VARCHAR(50)
	- intervalos <INTERVALO>list
	- esta_activo BOOL
	* VOID __init__(id, tipo STR, ambito STR, nombre STR, esta_activo BOOL)
	* {bono INT, descripcion STR} aplicar_regla(contexto OBJ)
	* VOID activar(VOID)
	* VOID desactivar(VOID)
	#getters y setters de tipo, ambito, nombre y esta_activo

INTERVALO:
	- minimo INT
	- maximo INT
	- descripcion STR
	- bono INT
	* VOID __init__(minimo INT=None, maximo INT=None, descripcion STR, bono INT = 0)
	* {bono INT, descripcion STR} aplicar(INT valor) # None si no aplica

FLOTA:
    - id INT 
    - nombre STR
    - esta_activa BOOL
    - mayor_rango_marina INT
    - mayor_rango_explorador INT
    - mayor_rango_broker INT
    - mayor_rango_socializar INT
    - mayor_rango_callejeo INT
    - mayor_bono_soc INT
    - planeta_actual STR
    - naves <NAVE>list
    * VOID __init__(id INT, nombre STR, esta_activa BOOL, mayor_rango_marina INT, mayor_rango_explorador INT, mayor_rango_broker INT, mayor_rango_socializar INT, mayor_rango_callejeo INT, mayor_bono_soc INT, planeta_actual STR)
    * VOID viajar(nuevo_sistema STR)
	* 
    # getters y setters de todo menos de id
    
LUGAR:
    - id INT AUTO_INCREMENT PRIMARY KEY
    - nombre VARCHAR(80) NOT NULL CHECK (trim(nombre) <> "")
    - tipo ESPACIO NOT NULL
    - aventura INT NOT NULL

NAVE (LUGAR):
    - id INT AUTO_INCREMENT PRIMARY KEY
    - carga_maxima INT NOT NULL CHECK (carga_maxima > 0)
    - auxiliar_total INT NOT NULL
    - mayor_auxiliar INT NOT NULL
    - camarotes_totales INT NOT NULL CHECK (camarotes_totales > 0)
    - literas_frias INT NOT NULL CHECK (literas_frias >= 0)
    - combustible INT NOT NULL CHECK (combustible > 0)
    - salto INT NOT NULL CHECK (salto >= 0)
    - armado BOOL NOT NULL
    - mantenimiento INT NOT NULL CHECK (mantenimiento > 0)
    - hipoteca INT NOT NULL CHECK (hipoteca >= 0)
    - fin_hipo DATE NOT NULL

REGISTRO_INTEGRANTES:
    - nave INT NOT NULL
    - flota INT NOT NULL
    - fecha_incorporacion DATE NOT NULL
    - fecha_finalizacion DATE NULL # NULL (por defecto) significa que sigue allí

REGISTRO_VIAJES:
	- flota INT NOT NULL
	- fecha DATE NOT NULL
	- sistema INT NOT NULL
	FOREIGN KEY (flota) REFERENCES flota(id)
    FOREIGN KEY (sistema) REFERENCES mercado(id)

PAQUETE:
    - id INT AUTO_INCREMENT PRIMARY KEY
    - nombre VARCHAR(150) NOT NULL
    - carga INT NOT NULL
    - auxiliar_necesario INT NOT NULL
    - camarotes_ocupados INT NOT NULL
    - notas TEXT

MERCADO(LUGAR):
    - id INT NOT NULL
    - codigo_planeta CHAR(9) NOT NULL  

REGISTRO_TRANSACCIONES:
    - id INT AUTO_INCREMENT PRIMARY KEY
    - nombre VARCHAR(200) NOT NULL
    - importe INT NOT NULL
    - fecha DATE NOT NULL
    - activo BOOL NOT NULL
    - notas TEXT
    * VOID activar()
    * VOID desactivar()

REGISTRO_PAQUETES:
    - paquete INT NOT NULL
    - lugar INT NOT NULL
    - fecha_incorporacion DATE NOT NULL
    - fecha_finalizacion DATE NULL # NULL (por defecto) significa que sigue allí
    CHECK ((SELECT count(*) FROM paquete_en_lugar AS p WHERE p.paquete = paquete AND p.lugar = lugar AND p.fecha_finalizacion IS NULL) <= 1)
    FOREIGN KEY (paquete) REFERENCES paquete(id)
    FOREIGN KEY (lugar) REFERENCES lugar(id)
    PRIMARY KEY (paquete, lugar, fecha_incorporacion)

<modelo>
    <aventura>
        <bien/>
        <regla>
            <intervalo/>
        </regla>
        <registro_paquetes/>
        <registro_integrantes/>
        <registro_viajes/>
        <registro_transacciones/>
        <flota/>
        <lugar>
            <mercado/>
            <nave depends="flota"/>
            <paquete/>
        </lugar>
    </aventura>
</modelo>

